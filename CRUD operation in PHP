<?php
// Database connection
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "cruddb";

$conn = mysqli_connect($servername, $username, $password, $dbname);

// Check connection
if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}

// Initialize variables
$item = "";
$item_id = "";
$pass = "";

// CRUD Operations
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    if (isset($_POST["add"])) {
        $item = $_POST["item"];
        $item_id = $_POST["item_id"];
        $pass = $_POST['pass'];
        $sql = "INSERT INTO crudtable (username,id,pass) VALUES ('$item','$item_id','$pass')";
        mysqli_query($conn, $sql);
    } elseif (isset($_POST["update"])) {
        $item_id = $_POST["item_id"];
        $item = $_POST["item"];
        $pass = $_POST['pass'];
        $sql = "UPDATE crudtable SET username='$item', pass='$pass' WHERE id=$item_id";
        mysqli_query($conn, $sql);
    }
}

if (isset($_GET["delete"])) {
    $delete_id = $_GET["delete"];
    $sql = "DELETE FROM crudtable WHERE id=$delete_id";
    mysqli_query($conn, $sql);
}

if (isset($_GET["edit"])) {
    $edit_id = $_GET["edit"];
    $sql = "SELECT * FROM crudtable WHERE id=$edit_id";
    $result = mysqli_query($conn, $sql);
    $row = mysqli_fetch_assoc($result);
    $edit_item = $row['username'];
}

// Fetch data from database
$sql = "SELECT * FROM crudtable";
$result = mysqli_query($conn, $sql);
$items = mysqli_fetch_all($result, MYSQLI_ASSOC);

mysqli_close($conn);
?>

<!DOCTYPE html>
<html>
<head>
    <title>CRUD Operations in PHP with SQL</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
<h2 class="text-center">CRUD Operation</h2>
<form method="post" action="<?php echo $_SERVER["PHP_SELF"]; ?>">
<label>ID: </lable><input type="text" class="form-control" name="item_id" value="<?php echo isset($edit_id) ? $edit_id : ''; ?>">
    
<label>Username: </label><input type="text" class="form-control" name="item" value="<?php echo isset($edit_item) ? $edit_item : ''; ?>" required>pass: <input type="text" class="form-control" name="pass" value="<?php echo isset($edit_item) ? $edit_item : ''; ?>" required>
    <br><button  class = "btn btn-primary" type="submit" name="<?php echo isset($edit_item) ? 'update' : 'add'; ?>">
    <?php echo isset($edit_item) ? 'Update' : 'Add'; ?></button>
</form>
<br>
<br>
<h2>Username List</h2>
<ul>
    <?php foreach ($items as $item): ?>
        <li><?php echo $item['username']. " ".$item['pass']; ?>
            <a href="?edit=<?php echo $item['id']; ?>">Edit</a>
            <a href="?delete=<?php echo $item['id']; ?>" onclick="return confirm('Are you sure you want to delete this item?');">Delete</a>
        </li>
    <?php endforeach; ?>
</ul>
</div>
</body>
</html>
    
